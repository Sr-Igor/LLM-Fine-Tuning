# ============================================================================
# MLX Configuration for Apple Silicon (.env.mlx.example)
# ============================================================================
# Rename to envs/.env.mlx or source before running make mlx:*
# ============================================================================

# ----------------------------------------------------------------------------
# MODEL
# ----------------------------------------------------------------------------
# HuggingFace model name to use
# Suggestions (Must be MLX compatible, usually from mlx-community):
# --- General Purpose ---
# - mlx-community/Meta-Llama-3.1-8B-Instruct-4bit      (Standard)
# - mlx-community/Mistral-NeMo-12B-Instruct-v1-4bit    (Great performance/size ratio)
#
# --- Coding & Reasoning ---
# - mlx-community/Qwen2.5-14B-Instruct-4bit            (Best 14B model available)
# - mlx-community/DeepSeek-R1-Distill-Qwen-14B-4bit    (Reasoning specialist)
# - mlx-community/Qwen2.5-Coder-7B-Instruct-4bit       (Specifically for code)
#
# --- Lightweight (Fastest on M1/M2 Air) ---
# - mlx-community/gemma-2-9b-it-4bit                   (Google's powerful 9B)
# - mlx-community/Phi-3.5-mini-instruct-4bit           (Microsoft, very light)
APPLE_MODEL_NAME=mlx-community/Qwen2.5-14B-Instruct-4bit

# Maximum sequence length (tokens)
APPLE_MAX_SEQ_LENGTH=2048

# ----------------------------------------------------------------------------
# LORA (Low-Rank Adaptation)
# ----------------------------------------------------------------------------
APPLE_LORA_LAYERS=16
APPLE_LORA_RANK=16
APPLE_LORA_ALPHA=16
APPLE_LORA_DROPOUT=0.0

# ----------------------------------------------------------------------------
# TRAINING
# ----------------------------------------------------------------------------
# Batch size (Adjust according to available memory)
APPLE_BATCH_SIZE=2

# Learning rate
APPLE_LEARNING_RATE=1e-5

# Total number of training iterations
APPLE_NUM_ITERS=100

# Steps between evaluations on validation set
APPLE_STEPS_PER_EVAL=100

# Steps between progress reports
APPLE_STEPS_PER_REPORT=10

# Number of batches for validation
APPLE_VAL_BATCHES=25

# Save checkpoint every N steps
APPLE_SAVE_EVERY=100

# ----------------------------------------------------------------------------
# DATA
# ----------------------------------------------------------------------------
APPLE_TRAIN_DATA=data/train.jsonl
APPLE_VALID_DATA=data/valid.jsonl
APPLE_DATA_DIR=data

# ----------------------------------------------------------------------------
# OUTPUT
# ----------------------------------------------------------------------------
APPLE_ADAPTER_PATH=adapters_mlx
APPLE_FUSED_MODEL=models/llm_mlx_fused
APPLE_GGUF_OUTPUT=models/llm_mlx.gguf

# ----------------------------------------------------------------------------
# APPLE SILICON OPTIMIZATIONS
# ----------------------------------------------------------------------------
APPLE_USE_METAL=true
APPLE_GRAD_CHECKPOINT=true
APPLE_SEED=42
